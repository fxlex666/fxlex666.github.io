var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},__extends=function(e,t){function r(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},__assign=Object.assign||function(e){for(var t,r=1,o=arguments.length;o>r;r++){t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},__rest=function(e,t){var r={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(r[o[n]]=e[o[n]]);return r},__decorate=function(e,t,r,o){var n,i=arguments.length,a=3>i?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(3>i?n(a):i>3?n(t,r,a):n(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},__param=function(e,t){return function(r,o){t(r,o,e)}},__metadata=function(e,t){return"object"==typeof Reflect&&"function"==typeof Reflect.metadata?Reflect.metadata(e,t):void 0},__awaiter=function(e,t,r,o){function n(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,i){function a(e){try{h(o.next(e))}catch(t){i(t)}}function s(e){try{h(o["throw"](e))}catch(t){i(t)}}function h(e){e.done?r(e.value):n(e.value).then(a,s)}h((o=o.apply(e,t||[])).next())})},__generator=function(e,t){function r(e){return function(t){return o([e,t])}}function o(r){if(n)throw new TypeError("Generator is already executing.");for(;h;)try{if(n=1,i&&(a=2&r[0]?i["return"]:r[0]?i["throw"]||((a=i["return"])&&a.call(i),0):i.next)&&!(a=a.call(i,r[1])).done)return a;switch(i=0,a&&(r=[2&r[0],a.value]),r[0]){case 0:case 1:a=r;break;case 4:return h.label++,{value:r[1],done:!1};case 5:h.label++,i=r[1],r=[0];continue;case 7:r=h.ops.pop(),h.trys.pop();continue;default:if(a=h.trys,!(a=a.length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){h=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){h.label=r[1];break}if(6===r[0]&&h.label<a[1]){h.label=a[1],a=r;break}if(a&&h.label<a[2]){h.label=a[2],h.ops.push(r);break}a[2]&&h.ops.pop(),h.trys.pop();continue}r=t.call(e,h)}catch(o){r=[6,o],i=0}finally{n=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var n,i,a,s,h={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:r(0),"throw":r(1),"return":r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},__exportStar=function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||__createBinding(t,e,r)},__createBinding=Object.create?function(e,t,r,o){void 0===o&&(o=r),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]},__values=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],o=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},__read=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var o,n,i=r.call(e),a=[];try{for(;(void 0===t||t-->0)&&!(o=i.next()).done;)a.push(o.value)}catch(s){n={error:s}}finally{try{o&&!o.done&&(r=i["return"])&&r.call(i)}finally{if(n)throw n.error}}return a},__spread=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(__read(arguments[t]));return e},__spreadArrays=function(){for(var e=0,t=0,r=arguments.length;r>t;t++)e+=arguments[t].length;for(var o=Array(e),n=0,t=0;r>t;t++)for(var i=arguments[t],a=0,s=i.length;s>a;a++,n++)o[n]=i[a];return o},__await=function(e){return this instanceof __await?(this.v=e,this):new __await(e)},__asyncGenerator=function(e,t,r){function o(e){u[e]&&(c[e]=function(t){return new Promise(function(r,o){f.push([e,t,r,o])>1||n(e,t)})})}function n(e,t){try{i(u[e](t))}catch(r){h(f[0][3],r)}}function i(e){e.value instanceof __await?Promise.resolve(e.value.v).then(a,s):h(f[0][2],e)}function a(e){n("next",e)}function s(e){n("throw",e)}function h(e,t){e(t),f.shift(),f.length&&n(f[0][0],f[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c,u=r.apply(e,t||[]),f=[];return c={},o("next"),o("throw"),o("return"),c[Symbol.asyncIterator]=function(){return this},c},__asyncDelegator=function(e){function t(t,n){r[t]=e[t]?function(r){return(o=!o)?{value:__await(e[t](r)),done:"return"===t}:n?n(r):r}:n}var r,o;return r={},t("next"),t("throw",function(e){throw e}),t("return"),r[Symbol.iterator]=function(){return this},r},__asyncValues=function(e){function t(t){o[t]=e[t]&&function(o){return new Promise(function(n,i){o=e[t](o),r(n,i,o.done,o.value)})}}function r(e,t,r,o){Promise.resolve(o).then(function(t){e({value:t,done:r})},t)}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),o={},t("next"),t("throw"),t("return"),o[Symbol.asyncIterator]=function(){return this},o)},__makeTemplateObject=function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},__setModuleDefault=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e["default"]=t},__importStar=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t},__importDefault=function(e){return e&&e.__esModule?e:{"default":e}},__classPrivateFieldGet=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},__classPrivateFieldSet=function(e,t,r){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,r),r},__reflect=function(e,t,r){e.__class__=t,r?r.push(t):r=[t],e.__types__=e.__types__?r.concat(e.__types__):r};!function(e){function t(o){if(r[o])return r[o].exports;var n=r[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,o){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var n in e)t.d(o,n,function(t){return e[t]}.bind(null,n));return o},t.n=function(e){var r=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,r){r(1),r(2),r(0),r(3),r(4);var o=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(e){egret.lifecycle.addLifecycleListener(function(e){e.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.loadResource()];case 1:return e.sent(),this.createGameScene(),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return r.sent(),[4,RES.loadGroup("preload",0,e)];case 2:return r.sent(),this.stage.removeChild(e),[3,4];case 3:return t=r.sent(),console.error(t),[3,4];case 4:return[2]}})})},t.prototype.createGameScene=function(){var e=new Game.gameCenter;this.stage.addChild(e)},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,r=RES.getRes(e);return t.texture=r,t},t}(egret.DisplayObjectContainer);window.Main=o,__reflect(o.prototype,"Main",[])},function(e,t){var r,r=window.Game;!function(e){function t(e){var t=new egret.Bitmap,r=RES.getRes(e);return t.texture=r,t}function r(e,t,r,o){var n=r-e,i=o-t,a=Math.pow(n*n+i*i,.5);return a}function o(e){var t=e.$texture.$bitmapHeight*e.width/e.$texture.$bitmapWidth;return t}var n=function(){function e(){}return e.hitTest=function(e,t){var r=e.getBounds(),o=t.getBounds();return r.x=e.x,r.y=e.y,o.x=t.x,o.y=t.y,r.intersects(o)},e}();e.GameUtil=n,__reflect(n.prototype,"Game.GameUtil",[]),e.createBitmapByName=t,e.distanceCAL=r,e.autoHeight=o}(r||(r={})),window.Game=r},function(e,t){var r=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);window.LoadingUI=r,__reflect(r.prototype,"LoadingUI",["RES.PromiseTaskReporter"])},function(e,t){var r=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();window.DebugPlatform=r,__reflect(r.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new r)},function(e,t){var r,r=window.Game;!function(e){var t=function(t){function r(){var e=t.call(this)||this;return e.gameConfig={initTime:60,scoreCount:0,rowNum:6,colNum:6,countAvatar:4,needitem:3,xiaoTime:3,moveTime:150,dir:0,TouchHashCode:0,currentTarget:null,ismoveing:!1,istouching:!1,needReset:!1},e.frameArr=[],e.needMove=[],e.moveArr=[],e.dropArr=[],e.dropItems=[],e.finishMove=0,e.topy=0,e.touchstartX=0,e.touchstartY=0,e.dieresetTime=0,e.dieresetMaxTime=10,e.xiaomp3=RES.getRes("xiao_mp3"),e.downmp3=RES.getRes("down_mp3"),e.boomwav=RES.getRes("bao_wav"),e.firstTouch=!0,e.makeboomNum=0,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(r,t),r.prototype.onAddToStage=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.creatBg()},r.prototype.creatBg=function(){this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight;var t=e.createBitmapByName("stylebg1_i6_jpg");this.addChild(t),t.width=this.stageW,this.creatMatrix()},r.prototype.creatMatrix=function(){this.frameArr=this.createArr(this.gameConfig.rowNum,this.gameConfig.colNum),this.showMatrix()},r.prototype.showMatrix=function(){for(var e=0;e<this.frameArr.length;e++)for(var t=0;t<this.frameArr[e].length;t++)this.makeAvatar(t,e,"init");if(!this.checkIsLive()){console.log("死局，重置全部元素");for(var e=0;e<this.frameArr.length;e++)for(var t=0;t<this.frameArr[e].length;t++)this.removeChild(this.frameArr[e][t]);this.showMatrix()}},r.prototype.createArr=function(e,t){for(var r=[],o=0;e>o;o++){r[o]=new Array;for(var n=0;t>n;n++)r[o][n]={}}return r},r.prototype.makeBoom=function(t,r,o){var n=e.createBitmapByName("dan_png");n.width=90,n.height=e.autoHeight(n);var i=(this.stageW-this.gameConfig.colNum*n.width)/2;n.x=i+t*n.width,n.y=-(n.height*(this.gameConfig.rowNum-r-o))+this.topy,n.row=r,n.col=t,n.typeid=99,n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.propsBoom,this),this.frameArr[r][t]=n,this.addChild(n),this.makeboomNum++,console.log(n);var a=egret.Tween.get(n,{loop:!1}),s=n.height*n.row+this.topy;a.to({y:s},this.gameConfig.moveTime).call(function(){console.log("炸弹下落完成")},this)},r.prototype.makeAvatar=function(t,r,o){var n=parseInt(String(Math.random()*this.gameConfig.countAvatar))+1,i=e.createBitmapByName("avatar1_0"+n+"_png");i.width=90,i.height=e.autoHeight(i);var a=(this.stageW-this.gameConfig.colNum*i.width)/2;if(this.topy=(this.stageH-this.gameConfig.rowNum*i.height)/2,i.x=a+t*i.width,i.row=r,i.col=t,i.typeid=n,i.touchEnabled=!0,i.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchHandler,this),i.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchbegin,this),i.addEventListener(egret.TouchEvent.TOUCH_END,this.touchend,this),i.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.touchend,this),"undefined"==typeof o||"init"==o){if(i.y=i.height*r+this.topy,this.frameArr[r][t]=i,this.addChild(i),this.inX(r,t,[])||this.inY(r,t,[]))return this.removeChild(i),console.log("可消除元素，重新生成"),void this.makeAvatar(t,r,"init")}else if(i.y=-(i.height*(this.gameConfig.rowNum-r-o))+this.topy,this.frameArr[r][t]=i,this.addChild(i),!this.checkIsLive()&&this.dieresetTime<this.dieresetMaxTime)this.dieresetTime++,console.log("无法消除重置元素次数："+this.dieresetTime+"        第几行："+r+"第几列："+t),this.removeChild(i),this.makeAvatar(t,r,o);else{this.dieresetTime=0;var s=egret.Tween.get(i,{loop:!1}),h=i.height*i.row+this.topy;s.to({y:h},this.gameConfig.moveTime).call(function(){this.finishMove++,this.finishMove==this.needMove.length-this.makeboomNum&&(this.makeboomNum=0,console.log("全部新元素下落完成"),this.finishMove=0,this.needMove=[],this.checkAll())},this)}},r.prototype.propsBoom=function(e){var t=this;if(!this.gameConfig.ismoveing){this.boomwav.play(0,1),this.gameConfig.ismoveing=!0;var r=RES.getRes("baozhao_json"),o=RES.getRes("baozhao_png"),n=new egret.MovieClipDataFactory(r,o),i=new egret.MovieClip(n.generateMovieClipData("baozha"));this.addChild(i),i.scaleX=1.7,i.scaleY=1.7,i.x=e.currentTarget.x-1.6*e.currentTarget.width,i.y=e.currentTarget.y-1.5*e.currentTarget.height,i.gotoAndPlay("zha",1);var a=e.currentTarget;i.addEventListener(egret.Event.COMPLETE,function(e){t.removeChild(e.$currentTarget),t.dropItems=[],t.dropArr=[];for(var r=0;r<t.gameConfig.rowNum;r++)for(var o=0;o<t.gameConfig.colNum;o++){var n=t.frameArr[r][o];if(Math.abs(n.col-a.col)<=1&&Math.abs(n.row-a.row)<=1){n.removeEventListener(egret.TouchEvent.TOUCH_MOVE,t.touchHandler,t),n.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,t.touchbegin,t),n.removeEventListener(egret.TouchEvent.TOUCH_END,t.touchend,t),n.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,t.touchend,t);var i=[r,o];t.moveArr.push(i),t.frameArr[r][o].disapear=!0,t.frameArr[r][o].typeid="",t.removeChild(n),t.needMove.push([r,o])}}console.log(t.needMove),t.checkDropDown(!1)},this)}},r.prototype.touchend=function(e){console.log("touchend"),this.gameConfig.istouching=!1},r.prototype.touchbegin=function(e){if(this.firstTouch){var t=this.xiaomp3.play(0,1);t.volume=0;var r=this.downmp3.play(0,1);r.volume=0;var o=this.boomwav.play(0,1);o.volume=0,this.firstTouch=!1}this.gameConfig.ismoveing||(this.gameConfig.istouching=!0,this.touchstartX=e.stageX,this.touchstartY=e.stageY,this.gameConfig.TouchHashCode=e.currentTarget.$hashCode,console.log(e.currentTarget),this.gameConfig.currentTarget=e.currentTarget)},r.prototype.touchHandler=function(e){console.log("istouching: "+this.gameConfig.istouching+" ismoveing: "+this.gameConfig.ismoveing),!this.gameConfig.ismoveing&&this.gameConfig.istouching&&this.gameConfig.TouchHashCode!=e.currentTarget.$hashCode&&99!=e.currentTarget.typeid&&(this.gameConfig.ismoveing=!0,this.gameConfig.istouching=!1,Math.abs(e.stageX-this.touchstartX)>=Math.abs(e.stageY-this.touchstartY)?e.stageX>this.touchstartX?(console.log("向右"),this.changeItem(1,this.gameConfig.currentTarget,"none")):(console.log("向左"),this.changeItem(2,this.gameConfig.currentTarget,"none")):e.stageY>this.touchstartY?(console.log("向下"),this.changeItem(3,this.gameConfig.currentTarget,"none")):(console.log("向上"),this.changeItem(4,this.gameConfig.currentTarget,"none")))},r.prototype.inLine=function(e,t,r){return""==r?this.inX(e,t,[])||this.inY(e,t,[]):this.inX(e,t,r)||this.inY(e,t,r)},r.prototype.inX=function(e,t,r){(""==r||0==r.length)&&(r=this.frameArr);for(var o=r[e][t].typeid,n=[],i=0,a=0;a<this.gameConfig.colNum;a++)if("undefined"!=typeof r[e][a].typeid&&""!=r[e][a].typeid&&r[e][a].typeid==o&&99!=r[e][a].typeid)i++,n.push([e,a]);else{if(!(i<this.gameConfig.needitem))break;i=0,n=[]}return i>=this.gameConfig.needitem?n:!1},r.prototype.inY=function(e,t,r){(""==r||0==r.length)&&(r=this.frameArr);for(var o=r[e][t].typeid,n=[],i=0,a=0;a<this.gameConfig.rowNum;a++)if("undefined"!=typeof r[a][t].typeid&&""!=r[a][t].typeid&&r[a][t].typeid==o&&99!=r[a][t].typeid)i++,n.push([a,t]);else{if(!(i<this.gameConfig.needitem))break;i=0,n=[]}return i>=this.gameConfig.needitem?n:!1},r.prototype.markDisapear=function(e,t){var r=[],o=[];o.push(this.inX(e.row,e.col,[])),o.push(this.inY(e.row,e.col,[])),o.push(this.inX(t.row,t.col,[])),o.push(this.inY(t.row,t.col,[]));for(var n=0;n<o.length;n++)o[n]&&Array.isArray(o[n])&&(r=r.concat(o[n]));r=this.unique(r),console.log(r),r.length>0?(this.needMove=this.uniqueRemove(r),console.log("消除")):(this.gameConfig.needReset=!0,console.log("还原"))},r.prototype.unique=function(e){return Array.from(new Set(e))},r.prototype.uniqueRemove=function(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r].join(""));t=this.uniqueArr(t);for(var o=[],r=0;r<t.length;r++)o.push(t[r].split(""));return o},r.prototype.uniqueArr=function(e){e.sort();for(var t=[e[0]],r=1;r<e.length;r++)e[r]!==t[t.length-1]&&t.push(e[r]);return t},r.prototype.changeItem=function(e,t,r){var o,n=t;switch(this.gameConfig.dir=e,e){case 1:if(n.col+1>=this.gameConfig.colNum)return void this.moveout();this.gameConfig.dir=1;var i=this.frameArr[n.row][parseInt(n.col)+1];if(99==i.typeid)return void this.moveout();this.changePosition(n,i,r),this.frameArr[n.row][n.col]=i,this.frameArr[n.row][parseInt(n.col)+1]=n,console.log(i),n.col+=1,i.col-=1,o=i;break;case 2:if(n.col-1<0)return void this.moveout();this.gameConfig.dir=2;var a=this.frameArr[n.row][parseInt(n.col)-1];if(99==a.typeid)return void this.moveout();this.changePosition(n,a,r),this.frameArr[n.row][n.col]=a,this.frameArr[n.row][parseInt(n.col)-1]=n,n.col-=1,a.col+=1,o=a;break;case 3:if(n.row+1>=this.gameConfig.rowNum)return void this.moveout();this.gameConfig.dir=3;var s=this.frameArr[parseInt(n.row)+1][n.col];if(99==s.typeid)return void this.moveout();this.changePosition(n,s,r),this.frameArr[n.row][n.col]=s,this.frameArr[parseInt(n.row)+1][n.col]=n,n.row+=1,s.row-=1,o=s;break;case 4:if(n.row-1<0)return void this.moveout();this.gameConfig.dir=4;var h=this.frameArr[parseInt(n.row)-1][n.col];if(99==h.typeid)return void this.moveout();this.changePosition(n,h,r),this.frameArr[n.row][n.col]=h,this.frameArr[parseInt(n.row)-1][n.col]=n,n.row-=1,h.row+=1,o=h}"reset"!==r?this.markDisapear(n,o):this.gameConfig.needReset=!1},r.prototype.moveout=function(){this.gameConfig.ismoveing=!1},r.prototype.changePosition=function(e,t,r){function o(e){if(a){if(console.log("动画完成"),"reset"==r)return void(e.gameConfig.ismoveing=!1);e.gameConfig.needReset?e.changeItem(e.gameConfig.dir,t,"reset"):e.eliminate()}else a=!0}var n={x:e.x,y:e.y},i={x:t.x,y:t.y},a=!1,s=this,h=egret.Tween.get(e,{loop:!1});h.to({x:i.x,y:i.y},this.gameConfig.moveTime).call(function(){o(s)},this);var c=egret.Tween.get(t,{loop:!1});c.to({x:n.x,y:n.y},this.gameConfig.moveTime).call(function(){o(s)},this)},r.prototype.eliminate=function(){var e=this;this.dropItems=[],this.dropArr=[];for(var t=this.needMove,r=0;r<t.length;r++){var o=t[r][1],n=t[r][0],i=[n,o];this.moveArr.push(i),this.frameArr[n][o].disapear=!0}console.log("消除"),this.xiaomp3.play(0,1);for(var a=0,s="",h=0,c=0,u=0;u<this.gameConfig.rowNum;u++)for(var f,l,g,m,p,d=function(){var r=v.frameArr[u][y];if(r.disapear){s==r.typeid?(a++,3==a&&(h=u,c=y)):a=0,s=r.typeid,v.frameArr[u][y].typeid="",f=RES.getRes("boom_json"),l=RES.getRes("boom_png"),g=new egret.MovieClipDataFactory(f,l),m=new egret.MovieClip(g.generateMovieClipData("boom")),v.addChild(m),m.scaleX=1.25,m.scaleY=1.25,m.x=r.x;var o=r.height*r.row+v.topy;m.y=o,m.gotoAndPlay("boomMoive",v.gameConfig.xiaoTime),p=0,m.addEventListener(egret.Event.COMPLETE,function(o){if(e.removeChild(o.$currentTarget),r.removeEventListener(egret.TouchEvent.TOUCH_MOVE,e.touchHandler,e),r.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,e.touchbegin,e),r.removeEventListener(egret.TouchEvent.TOUCH_END,e.touchend,e),r.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,e.touchend,e),e.removeChild(r),p++,p==t.length){console.log(a);var n=!1;a>=3&&(console.log("炸弹道具"),n=!0),e.checkDropDown(n)}},v)}},v=this,y=0;y<this.gameConfig.colNum;y++)d()},r.prototype.checkDropDown=function(e){for(var t=[],r=0;r<this.needMove.length;r++){var o=this.needMove[r][1],n=[];if(t.indexOf(o)<0){t.push(o);for(var i=0;i<this.frameArr.length;i++)if(!this.frameArr[i][o].disapear){for(var a=0,s=0;s<this.needMove.length;s++)this.needMove[s][1]==o&&this.needMove[s][0]>i&&a++;if(a>0){console.log("下落个数:"+a),console.log("是否生成炸弹："+e+"   下落元素第几列："+o+"      炸弹第几列：");var h=this.frameArr[i][o];this.dropItems.push({or:i,oc:o,row:i+a,item:h}),n.push(h)}}this.dropArr.push({col:o,count:n.length})}}this.dropAll(e)},r.prototype.checkDrop=function(){for(var e=0;e<this.dropItems.length;e++)for(var t=e+1;t<this.dropItems.length;t++)this.dropItems[e].or==this.dropItems[t].or&&this.dropItems[e].oc==this.dropItems[t].oc&&(this.dropItems.splice(t,1),t--)},r.prototype.dropAll=function(e){this.checkDrop();for(var t=0;t<this.dropItems.length;t++){this.dropItems[t].item.row=this.dropItems[t].row,this.frameArr[this.dropItems[t].item.row][this.dropItems[t].item.col]=this.dropItems[t].item;var r=this.frameArr[this.dropItems[t].item.row][this.dropItems[t].item.col],o=egret.Tween.get(r,{loop:!1}),n=r.height*r.row+this.topy;o.to({y:n},this.gameConfig.moveTime).call(function(){console.log("下落完成")},this)}var i=this;setTimeout(function(){i.downmp3.play(0,1)},this.gameConfig.moveTime/2),console.log("====================");for(var a=this.dropArr.length,s=this.moveArr.length,t=0;a>t;t++){for(var h=0,c=0;s>c;c++)this.moveArr[c][1]==this.dropArr[t].col&&h++;console.log("需要补充的元素："+h);for(var u=h;u>0;u--){var f=Number(this.dropArr[t].col);e&&u==h-1?this.makeBoom(f,u-1,this.dropArr[t].count):this.makeAvatar(f,u-1,this.dropArr[t].count)}}this.moveArr=[],this.dropItems=[]},r.prototype.checkAll=function(){for(var e=!1,t=0;t<this.gameConfig.rowNum;t++)for(var r=0;r<this.gameConfig.colNum;r++){var o=[],n=[];n.push(this.inX(t,r,[])),n.push(this.inY(t,r,[]));for(var i=0;i<n.length;i++)n[i]&&Array.isArray(n[i])&&(o=o.concat(n[i]));if(o=this.unique(o),o.length>0){this.needMove=this.needMove.concat(o),e=!0;break}}if(e)this.needMove=this.uniqueRemove(this.needMove),this.eliminate();else if(this.checkIsLive())console.log("检查没有自动消除，恢复触摸"),this.gameConfig.ismoveing=!1;else{console.log("死局");for(var t=0;t<this.frameArr.length;t++)for(var r=0;r<this.frameArr[t].length;r++)this.needMove.push([t,r]);this.eliminate()}},r.prototype.twoClone=function(e){for(var t=[],r=0;r<e.length;r++)t[r]=e[r].concat();return t},r.prototype.checkIsLive=function(){for(var e=this.twoClone(this.frameArr),t=0;t<this.gameConfig.rowNum;t++)for(var r=0;r<this.gameConfig.colNum;r++){if(t>0){if(e=this.exchange(e,r,t,r,t-1),this.inLine(t,r,e))return!0;e=this.exchange(e,r,t-1,r,t)}if(t<this.gameConfig.rowNum-1){if(e=this.exchange(e,r,t,r,t+1),this.inLine(t,r,e))return!0;e=this.exchange(e,r,t+1,r,t)}if(r>0){if(e=this.exchange(e,r,t,r-1,t),this.inLine(t,r,e))return!0;e=this.exchange(e,r-1,t,r,t)}if(r<this.gameConfig.colNum-1){if(e=this.exchange(e,r,t,r+1,t),this.inLine(t,r,e))return!0;e=this.exchange(e,r+1,t,r,t)}}return!1},r.prototype.exchange=function(e,t,r,o,n){var i=e[r][t];return e[r][t]=e[n][o],e[n][o]=i,e},r}(egret.DisplayObjectContainer);e.gameCenter=t,__reflect(t.prototype,"Game.gameCenter",[])}(r||(r={})),window.Game=r}]);